<!--This is the page where visitors and users can view all listings without loggin in-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartBid Home</title>
    <link rel="stylesheet" href="../../../static/web.css">
</head>
<body>
    <!-- Navbar -->
    <div class="navbar">
        <div class="logo">
            <a href="/" style="text-decoration: none; color: inherit; display: inline-block;">
                <h1 style="margin: 0;">SmartBid <span>ðŸ’¡</span></h1>
            </a>
        </div>
        <a href="{% url 'login' %}" class="login-btn">Log In</a>
    </div>

    <!-- Search Bar -->
    <div class="search-bar">
        <input type="text" placeholder="Search for anything...">

        <!-- Category Dropdown -->
        <select id="category-dropdown">
            <option value="all">All Categories</option>
            <option value="Electronics">Electronics</option>
            <option value="School Essentials">School Essentials</option>
            <option value="Fashion & Apparel">Fashion & Apparel</option>
            <option value="Accessories & Gadgets">Accessories & Gadgets</option>
            <option value="Home & Kitchen">Home & Kitchen</option>
        </select>

        <button id="search-button">Search</button>
    </div>
    

    <!-- Filter Popup 
    <div id="filter-popup" class="popup">
        <div class="popup-content">
            <span class="close-button">&times;</span>
            <h2>Filters</h2>
            <div class="filter-option">
                <label for="categories">Categories:</label>
                <select id="categories">
                    <option value="all">All Categories</option>
                    <option value="category1">Electronics</option>
                    <option value="category2">School Essentials</option>
                    <option value="category3">Fashion & Apparel</option>
                    <option value="category3">Accessories & Gadgets</option>
                    <option value="category3">Home & Kitchen</option>
                </select>
            </div>
            <button id="apply-filters">Apply</button>
        </div>
    </div>
    -->

    <!-- Category Sections -->
    {% if electronics %}
    <div class="category-section">
        <h1>Electronics</h1>
        <div class="item-carousel">
            {% for item in electronics %}
            <div class="item-card">
                <div class="item-image">
                    <img src="{{ item.image_url }}" alt="{{ item.title }}">
                </div>
                <div class="item-info">
                    <p class="item-name">{{ item.title }}</p>
                    <p class="item-price">${{ item.price }}</p>
                    <p class="item-time">{{ item.availability }}</p>
                </div>
            </div>
            {% empty %}
            <p>No electronics listings available</p>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if school_essentials %}
    <div class="category-section">
        <h1>School Essentials</h1>
        <div class="item-carousel">
            {% for item in school_essentials %}
            <div class="item-card">
                <div class="item-image">
                    <img src="{{ item.image_url }}" alt="{{ item.title }}">
                </div>
                <div class="item-info">
                    <p class="item-name">{{ item.title }}</p>
                    <p class="item-price">${{ item.price }}</p>
                    <p class="item-time">{{ item.availability }}</p>
                </div>
            </div>
            {% empty %}
            <p>No school essentials listings available</p>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if fashion %}
    <div class="category-section">
        <h1>Fashion & Apparel</h1>
        <div class="item-carousel">
            {% for item in fashion %}
            <div class="item-card">
                <div class="item-image">
                    <img src="{{ item.image_url }}" alt="{{ item.title }}">
                </div>
                <div class="item-info">
                    <p class="item-name">{{ item.title }}</p>
                    <p class="item-price">${{ item.price }}</p>
                    <p class="item-time">{{ item.availability }}</p>
                </div>
            </div>
            {% empty %}
            <p>No fashion listings available</p>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if accessories %}
    <div class="category-section">
        <h1>Accessories & Gadgets</h1>
        <div class="item-carousel">
            {% for item in accessories %}
            <div class="item-card">
                <div class="item-image">
                    <img src="{{ item.image_url }}" alt="{{ item.title }}">
                </div>
                <div class="item-info">
                    <p class="item-name">{{ item.title }}</p>
                    <p class="item-price">${{ item.price }}</p>
                    <p class="item-time">{{ item.availability }}</p>
                </div>
            </div>
            {% empty %}
            <p>No accessories listings available</p>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if home_kitchen %}
    <div class="category-section">
        <h1>Home & Kitchen</h1>
        <div class="item-carousel">
            {% for item in home_kitchen %}
            <div class="item-card">
                <div class="item-image">
                    <img src="{{ item.image_url }}" alt="{{ item.title }}">
                </div>
                <div class="item-info">
                    <p class="item-name">{{ item.title }}</p>
                    <p class="item-price">${{ item.price }}</p>
                    <p class="item-time">{{ item.availability }}</p>
                </div>
            </div>
            {% empty %}
            <p>No home & kitchen listings available</p>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchInput = document.querySelector('.search-bar input');
            const searchButton = document.getElementById('search-button');
            const categoryDropdown = document.getElementById('category-dropdown');
            const itemCards = document.querySelectorAll('.item-card');
            const categorySections = document.querySelectorAll('.category-section');
            const resultsLabel = document.createElement('h2');
            const noResultsMessage = document.createElement('p');

            resultsLabel.textContent = 'Results';
            resultsLabel.id = 'results-label';
            resultsLabel.style.display = 'none';
            document.querySelector('.search-bar').after(resultsLabel);

            noResultsMessage.textContent = 'No results found';
            noResultsMessage.id = 'no-results-message';
            noResultsMessage.style.display = 'none';
            document.querySelector('.search-bar').after(noResultsMessage);

        searchButton.addEventListener('click', function () {
            const searchTerm = searchInput.value.toLowerCase().trim();
            const selectedCategory = categoryDropdown.value.toLowerCase();
            let resultsFound = false;

            // Hide all sections, item cards, and reset visibility for labels
            categorySections.forEach(section => {
                section.style.display = 'none';
                const header = section.querySelector('h1');
                if (header) header.style.display = 'none'; // Hide the category header
            });

            itemCards.forEach(card => {
                card.style.display = 'none';
            });

            resultsLabel.style.display = 'none';
            noResultsMessage.style.display = 'none';

            // Search and filter item cards
            itemCards.forEach(card => {
                const itemName = card.querySelector('.item-name').textContent.toLowerCase();
                const categorySection = card.closest('.category-section');
                const categoryHeader = categorySection.querySelector('h1');

                const isSearchMatch = itemName.includes(searchTerm);
                const isCategoryMatch = selectedCategory === 'all' || categoryHeader.textContent.toLowerCase().includes(selectedCategory);

                if (isSearchMatch && isCategoryMatch) {
                    card.style.display = 'block'; // Show the matching card
                    categorySection.style.display = 'block'; // Show the category section
                    resultsFound = true;
                }
            });

            // Show the "Results" header or "No Results Found" message
            if (resultsFound) {
                resultsLabel.style.display = 'block';
            } else {
                noResultsMessage.style.display = 'block';
            }
        });

        const maxLength = 15; // Set the maximum length for item names
        const itemNames = document.querySelectorAll('.item-name');

        itemNames.forEach(itemName => {
            const fullText = itemName.textContent.trim();
            if (fullText.length > maxLength) {
                itemName.textContent = fullText.slice(0, maxLength) + '...';
                itemName.setAttribute('title', fullText); // Add a tooltip with the full name
            }
        });
        });
    </script>
</body>
</html>